//! alga v1.0.0
//! Copyright (c) 2016, Yuri Sementsov <hello@semencov.com>
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Alga=t()}(this,function(){"use strict";function e(t){for(var i=function(i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&("[object Object]"===Object.prototype.toString.call(i[n])?t[n]=e(t[n],i[n]):t[n]=i[n])},n=arguments.length,o=Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];for(var r in o)i(o[r]);return t}function t(e){return parseFloat(e.toFixed(2))}function i(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments[1];if("object"!==("undefined"==typeof e?"undefined":o(e)))throw new Error("Haystack must be an Object");var i=Array.isArray(e)?e:Object.keys(e);return i.push(t),i.sort(),i.indexOf(t)}var n={"2010-01-01":{currency:"LVL",incomeTaxRate:26,riskFee:.25,socialTaxRates:[9,7.06,7.73],employerTaxRates:[24.09,18.88,20.68],exemptionLimit:35,dependentBenefit:63,invalidBenefit:[0,108,84],victimBenefit:108},"2011-01-01":{currency:"LVL",incomeTaxRate:25,riskFee:.25,socialTaxRates:[11,9.2,9.96],employerTaxRates:[24.09,20.16,21.82],exemptionLimit:45,dependentBenefit:70,invalidBenefit:[0,108,84],victimBenefit:108},"2012-01-01":{currency:"LVL",incomeTaxRate:25,riskFee:.25,socialTaxRates:[11,9.5,9.29],employerTaxRates:[24.09,20.8,22.53],exemptionLimit:45,dependentBenefit:70,invalidBenefit:[0,108,84],victimBenefit:108},"2013-01-01":{currency:"LVL",incomeTaxRate:24,riskFee:.25,socialTaxRates:[11,9.45,10.2],employerTaxRates:[24.09,20.68,22.35],exemptionLimit:45,dependentBenefit:70,invalidBenefit:[0,108,84],victimBenefit:108},"2013-07-01":{currency:"LVL",incomeTaxRate:24,riskFee:.25,socialTaxRates:[11,9.45,10.2],employerTaxRates:[24.09,20.68,22.35],exemptionLimit:45,dependentBenefit:80,invalidBenefit:[0,108,84],victimBenefit:108},"2014-01-01":{currency:"EUR",incomeTaxRate:24,riskFee:.36,socialTaxRates:[10.5,8.96,9.69],employerTaxRates:[23.59,20.16,21.79],exemptionLimit:75,dependentBenefit:165,invalidBenefit:[0,154,120],victimBenefit:154},"2015-01-01":{currency:"EUR",incomeTaxRate:23,riskFee:.36,socialTaxRates:[10.5,8.84,9.57],employerTaxRates:[23.59,19.86,21.5],exemptionLimit:75,dependentBenefit:165,invalidBenefit:[0,154,120],victimBenefit:154},"2016-01-01":{currency:"EUR",incomeTaxRate:23,riskFee:.36,socialTaxRates:[10.5,8.85,9.57],employerTaxRates:[23.59,19.9,21.51],exemptionLimit:75,dependentBenefit:175,invalidBenefit:[0,154,120],victimBenefit:154}},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(){function e(e,t){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(c){o=!0,a=c}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw a}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=new WeakMap,u=function(){function o(){var t=arguments.length<=0||void 0===arguments[0]?new Date:arguments[0],r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(a(this,o),!(t instanceof Date))throw new Error("Can not recognize date format");var u=t.toISOString().split("T"),f=s(u,1),p=f[0],l=Object.keys(n),m=i(l,p),T=l[m-1],d={rates:n[T],options:e({dependents:0,pensionStatus:o.PENSION_STATUS_NONE,invalidStatus:o.INVALID_STATUS_NONE,victimStatus:!1,hasTaxBook:!0,hasContract:!0},r),netto:0,brutto:0,mode:o.MODE_BRUTTO,iin:0,vsaoi:{employee:0,employer:0},taxes:0,benefits:{dependents:0,extra:0},total:0,exemptionLimit:0};c.set(this,d)}return r(o,[{key:"_calc",value:function(){var i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=this.rates,a=e(c.get(this),i);if(a.benefits.dependents=a.options.hasTaxBook?t(a.options.dependents*n.dependentBenefit):0,a.benefits.extra=a.options.hasTaxBook&&a.options.victimStatus?Math.max(t(n.invalidBenefit),n.victimBenefit):t(n.invalidBenefit),a.mode===o.MODE_NETTO){var r=n.incomeTaxRate/100,s=n.socialTaxRate/100,u=1-s-r+s*r,f=n.exemptionLimit+a.benefits.dependents+a.benefits.extra;a.brutto=t(Math.max(0,a.netto-Math.min(a.netto,f)*r)/u)}a.vsaoi.employer=t(a.brutto/100*n.employerTaxRate),a.vsaoi.employee=t(a.brutto/100*n.socialTaxRate),a.iin=a.brutto-a.vsaoi.employee-n.exemptionLimit-a.benefits.dependents-a.benefits.extra,a.iin=Math.max(a.iin*n.incomeTaxRate,0),a.iin=Math.round(a.iin)/100,a.taxes=t(n.riskFee+a.iin+a.vsaoi.employer+a.vsaoi.employee),a.total=t(n.riskFee+a.brutto+a.vsaoi.employer),a.mode===o.MODE_BRUTTO&&(a.netto=a.brutto-a.vsaoi.employee-a.iin),a.mode===o.MODE_NETTO&&(a.brutto=t(a.netto+a.iin+a.vsaoi.employee)),c.set(this,a)}},{key:"brutto",get:function(){return c.get(this).brutto},set:function(e){e=parseFloat(e);var i={brutto:t(e),mode:o.MODE_BRUTTO};this._calc(i)}},{key:"netto",get:function(){return c.get(this).netto},set:function(e){e=parseFloat(e);var i={netto:t(e),mode:o.MODE_NETTO};this._calc(i)}},{key:"dependents",get:function(){return c.get(this).options.dependents},set:function(e){e=parseInt(e);var t={options:{dependents:Math.max(0,e)}};this._calc(t)}},{key:"pensionStatus",get:function(){return c.get(this).options.pensionStatus},set:function(e){if(e in[o.PENSION_STATUS_NONE,o.PENSION_STATUS_BY_AGE,o.PENSION_STATUS_BY_SERVICE]){var t={options:{pensionStatus:e}};this._calc(t)}}},{key:"invalidStatus",get:function(){return c.get(this).options.invalidStatus},set:function(e){if(e in[o.INVALID_STATUS_NONE,o.INVALID_STATUS_CAT_I,o.INVALID_STATUS_CAT_II,o.INVALID_STATUS_CAT_III]){var t={options:{invalidStatus:e}};this._calc(t)}}},{key:"isVictim",get:function(){return c.get(this).options.victimStatus},set:function(e){var t={options:{victimStatus:!!e}};this._calc(t)}},{key:"hasTaxbook",get:function(){return c.get(this).options.hasTaxBook},set:function(e){var t={options:{hasTaxBook:!!e}};this._calc(t)}},{key:"hasContract",get:function(){return c.get(this).options.hasContract},set:function(e){var t={options:{hasContract:!!e}};this._calc(t)}},{key:"total",get:function(){return c.get(this).total}},{key:"taxes",get:function(){return c.get(this).taxes}},{key:"iin",get:function(){return c.get(this).iin}},{key:"vsaoi",get:function(){return c.get(this).vsaoi}},{key:"benefits",get:function(){return c.get(this).benefits}},{key:"rates",get:function(){var e=c.get(this);return{incomeTaxRate:e.rates.incomeTaxRate,riskFee:e.rates.riskFee,socialTaxRate:e.rates.socialTaxRates[e.options.pensionStatus],employerTaxRate:e.rates.employerTaxRates[e.options.pensionStatus],exemptionLimit:!e.options.hasTaxBook||e.options.invalidStatus||e.options.pensionStatus?0:e.rates.exemptionLimit,dependentBenefit:e.options.hasTaxBook?e.rates.dependentBenefit:0,invalidBenefit:e.rates.invalidBenefit[e.options.invalidStatus],victimBenefit:e.options.victimStatus&&e.options.hasTaxBook?e.rates.victimBenefit:0}}}]),o}();return u.INVALID_STATUS_NONE=0,u.INVALID_STATUS_CAT_I=1,u.INVALID_STATUS_CAT_II=1,u.INVALID_STATUS_CAT_III=2,u.PENSION_STATUS_NONE=0,u.PENSION_STATUS_BY_AGE=1,u.PENSION_STATUS_BY_SERVICE=2,u.MODE_BRUTTO=1,u.MODE_NETTO=2,u});